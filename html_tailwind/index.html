<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ title | default('Fast Todo - Tailwind') }}</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="dark bg-black text-slate-100 min-h-screen">
    <div class="mx-auto py-1 px-1">
      <header class="mb-1">
      </header>
      <style>
        /* rotate the chevron icon when details is open */
        details[open] summary svg { transform: rotate(180deg); }
  /* priority glyph sizing and inline spacing (match html_no_js look) */
  .priority-inline { display:inline-block; margin-left:0.35rem; vertical-align:middle; }
  .priority-circle { font-size:2rem; line-height:1; }
  .priority-override .priority-circle { color:#ffb86b; }
  /* tag-chip styles copied from html_no_js/base.html (dark mode friendly) */
  .tag-chip { display:inline-flex; align-items:center; gap:0.35rem; background: rgba(30,64,175,0.4); border: 1px solid rgba(96,165,250,0.7); padding: 0.2rem 0.6rem; border-radius: 999px; color: #fff; text-decoration: none; margin: 0.12rem 0.35rem 0.12rem 0; transition: transform 120ms ease, box-shadow 120ms ease, background-color 120ms ease, color 120ms ease, border-color 120ms ease; cursor: pointer; }
  .tag-chip:hover { box-shadow: 0 6px 18px rgba(0,0,0,0.5); background: rgba(37,99,235,0.55); border-color: rgba(147,197,253,0.9); color: #fff; }
  .tag-chip:focus { outline: none; }
  .tag-chip:focus-visible { box-shadow: 0 0 0 3px rgba(88,166,255,0.45); }
  .tag-chip .label { font-weight: 600; font-size: 0.9rem; }
  /* list-title anchors use Tailwind utilities (keep styling consistent with rest of UI) */
      </style>

      <!-- include navbar -->
      {% include 'navbar.html' %}

      <!-- client search + create-list area (placed below navbar). Search on first line, create on second line -->
      <div class="mt-1 mb-1 flex flex-col gap-1">
        <div class="relative">
          <input id="tw-search-input" type="search" placeholder="Search lists & todos" class="w-80 px-1 py-1 rounded-md border border-slate-700 bg-slate-800 text-sm text-slate-100 focus:outline-none focus:ring-1 focus:ring-slate-600" />
        </div>
        <div class="flex items-center gap-1">
          <input id="tw-newlist-name" type="text" placeholder="New list name" class="px-1 py-1 rounded-md border border-slate-700 bg-slate-800 text-sm text-slate-100" />
          <button id="tw-create-list" class="px-1 py-1 bg-sky-600 hover:bg-sky-700 text-white rounded-md text-sm">Create</button>
        </div>
      <!-- server-rendered content: pinned, calendar, lists grouped by category -->
      <main class="mt-1">

        


  {# Render each category section in category.position order #}
  {% for cat in categories %}
  {% set cat_lists = lists_by_category.get(cat.id, []) %}
    {% if cat_lists and cat_lists|length > 0 %}
      <li class="category-section" data-category-id="{{ cat.id }}">
        <h3 class="category-header" data-target="cat-{{ cat.id }}" style="cursor:pointer; user-select:none;">
          <span class="twisty" aria-hidden="true">▾</span>
          <span class="category-name">{{ cat.name }}</span>
          <span class="count muted"> ({{ cat_lists|length }})</span>
        </h3>
        <ul id="cat-{{ cat.id }}" class="category-lists">
          {% for lst in cat_lists %}
            {% set created_iso = lst.created_at|in_tz(client_tz, '%Y-%m-%dT%H:%M:%S') %}
            {% set modified_iso = lst.modified_at|in_tz(client_tz, '%Y-%m-%dT%H:%M:%S') if lst.modified_at else None %}
            {# effective priority: use override_priority when present and higher than list.priority #}
            {% set eff = lst.override_priority if (lst.override_priority is not none and (lst.priority is none or lst.override_priority > lst.priority)) else lst.priority %}
            <li class="list-item"{% if created_iso %} data-created-at="{{ created_iso }}"{% endif %}{% if modified_iso %} data-modified-at="{{ modified_iso }}"{% endif %} data-priority="{{ eff if eff is not none else '' }}">
              <div class="list-main">
                <a class="list-title {% if lst.completed %}done{% endif %}" href="/html_no_js/lists/{{ lst.id }}">{{ lst.name }}</a>
                {% set circ = {0:'⓪',1:'①',2:'②',3:'③',4:'④',5:'⑤',6:'⑥',7:'⑦',8:'⑧',9:'⑨',10:'⑩'} %}
                {% if lst.priority %}
                  <span class="meta priority-inline"><span class="priority-circle">{{ circ.get(lst.priority, lst.priority) }}</span></span>
                {% endif %}
                {% if lst.override_priority and (lst.priority is none or lst.override_priority > lst.priority) %}
                  <span class="meta priority-inline priority-override" title="Highest uncompleted todo priority"><span class="priority-circle">{{ circ.get(lst.override_priority, lst.override_priority) }}</span></span>
                {% endif %}
                {% if lst.uncompleted_count is not none and not (lst.hide_icons|default(false)) %}
                  <span class="count-circle colour" aria-hidden="false" title="{{ circ.get(lst.uncompleted_count, lst.uncompleted_count) }} uncompleted todos">{{ lst.uncompleted_count }}</span>
                {% endif %}
                {% if lst.created_at %}
                  <div class="meta">cr. {{ lst.created_at|in_tz(client_tz, '%d/%m %-I:%M%p') }}</div>
                {% endif %}
                <div class="all-tags-inline" data-list-id="{{ lst.id }}" data-list-tags='{{ lst.hashtags | tojson }}' aria-hidden="true"></div>
              </div>
            </li>
          {% endfor %}
        </ul>
      </li>
    {% endif %}
  {% endfor %}
        <!-- controls: pill-group compact styling -->
        <div class="mt-1">
          <div class="flex items-center gap-2">
            <label class="inline-flex items-center gap-2 px-2 py-1 bg-black-800 border border-slate-700 rounded-md text-sm">
              <input type="checkbox" id="hide-completed-checkbox" class="mr-1"> Hide Completed
            </label>
            <div class="inline-flex items-center gap-2 px-2 py-1 bg-black-800 border border-slate-700 rounded-md text-sm">
              <span class="text-sm">Sort lists:</span>
              <select id="list-sort-order" class="ml-1 bg-transparent text-sm text-slate-100 border-none focus:outline-none">
                <option value="created">by creation date</option>
                <option value="modified">by modification date</option>
              </select>
            </div>
            <label class="inline-flex items-center gap-2 px-2 py-1 bg-black-800 border border-slate-700 rounded-md text-sm">
              <input type="checkbox" id="show-all-tags-checkbox" class="mr-1"> Show all tags
            </label>
          </div>
        </div>
      </main>
    </div>
  </body>
</html>
