<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ title | default('Fast Todo - Tailwind') }}</title>
  <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="dark bg-black text-slate-100 min-h-screen">
    <!-- include navbar outside the page wrapper to match layout.html -->
    {% include 'navbar.html' %}
    <div class="mx-auto py-0 px-0">
      <header class="mb-0">
      </header>
      <style>
        /* rotate the chevron icon when details is open */
        details[open] summary svg { transform: rotate(180deg); }
  /* priority glyph sizing and inline spacing (match html_no_js look) */
  .priority-inline { display:inline-block; margin-left:0.35rem; vertical-align:middle; }
  .priority-circle { font-size:2rem; line-height:1; }
  .priority-override .priority-circle { color:#ffb86b; }
  /* tag-chip styles copied from html_no_js/base.html (dark mode friendly) */
  .tag-chip { display:inline-flex; align-items:center; gap:0.35rem; background: rgba(30,64,175,0.4); border: 1px solid rgba(96,165,250,0.7); padding: 0.2rem 0.6rem; border-radius: 999px; color: #fff; text-decoration: none; margin: 0.12rem 0.35rem 0.12rem 0; transition: transform 120ms ease, box-shadow 120ms ease, background-color 120ms ease, color 120ms ease, border-color 120ms ease; cursor: pointer; }
  .tag-chip:hover { box-shadow: 0 6px 18px rgba(0,0,0,0.5); background: rgba(37,99,235,0.55); border-color: rgba(147,197,253,0.9); color: #fff; }
  .tag-chip:focus { outline: none; }
  .tag-chip:focus-visible { box-shadow: 0 0 0 3px rgba(88,166,255,0.45); }
  .tag-chip .label { font-weight: 600; font-size: 0.9rem; }
  /* list-title anchors use Tailwind utilities (keep styling consistent with rest of UI) */
      </style>

  <!-- client search + create-list area (placed below navbar). Search on first line, create on second line -->
      <div class="mt-1 mb-1 flex flex-col gap-1">
        <div class="relative">
          <input id="tw-search-input" type="search" placeholder="Search lists & todos" class="w-80 px-1 py-1 rounded-md border border-slate-700 bg-slate-800 text-sm text-slate-100 focus:outline-none focus:ring-1 focus:ring-slate-600" />
        </div>
        <div class="flex items-center gap-1">
          <input id="tw-newlist-name" type="text" placeholder="New list name" class="px-1 py-1 rounded-md border border-slate-700 bg-slate-800 text-sm text-slate-100" />
          <button id="tw-create-list" class="px-1 py-1 bg-sky-600 hover:bg-sky-700 text-white rounded-md text-sm">Create</button>
        </div>
        <!-- Quick add todo control for Tailwind index -->
        <div style="margin-top:0.5rem; display:flex; gap:0.5rem; align-items:center;">
          <input id="tw-quick-add-text" placeholder="Quick todo" class="px-1 py-1 rounded-md border border-slate-700 bg-slate-800 text-sm text-slate-100" style="flex:1; min-width:0;" />
          <button id="tw-quick-add-btn" class="px-2 py-1 bg-sky-600 text-white rounded-md text-sm">Add</button>
        </div>
      <!-- server-rendered content: pinned, calendar, lists grouped by category -->
      <main class="mt-1">

        {% if pinned_todos and pinned_todos|length > 0 %}
        <section class="pinned-todos mb-1">
          <h3 class="text-sm font-semibold mb-1">Pinned</h3>
          <ul class="space-y-1">
            {# sort pinned_todos by modified_at (newest first) #}
            {% for t in (pinned_todos | sort(attribute='modified_at') | reverse) %}
            <li class="flex items-start gap-1 bg-black-800 rounded p-1">
              <div class="mt-0.5 text-sky-400">ðŸ“Œ</div>
              <div class="flex-1">
                <a class="font-medium text-slate-100 hover:underline" href="/html_no_js/todos/{{ t.id }}">{{ t.text }}</a>
                <div class="text-xs text-slate-400">in <a class="text-sky-300 hover:underline" href="/html_tailwind/list?id={{ t.list_id }}">{{ t.list_name or t.list_id }}</a></div>
                {% if t.tags and t.tags|length > 0 %}
                <div class="mt-1 flex flex-wrap gap-1">
                  {% for tag in (t.tags | sort) %}
                  <a href="/html_no_js/search?q={{ tag|urlencode }}" class="tag-chip">{{ tag }}</a>
                  {% endfor %}
                </div>
                {% endif %}
              </div>
              <div class="text-xs text-slate-400">{% if t.priority %}P:{{ t.priority }}{% endif %}</div>
            </li>
            {% endfor %}
          </ul>
        </section>
        {% endif %}
        
        {% if pinned_lists and pinned_lists|length > 0 %}
        <section class="pinned-lists mb-1">
          <h3 class="text-sm font-semibold mb-1">Pinned Lists</h3>
          <ul class="space-y-1">
            {% for l in (pinned_lists | sort(attribute='name', case_sensitive=false)) %}
            <li class="flex items-start gap-1 bg-black-800 rounded p-1">
              <div class="mt-0.5 text-sky-400">ðŸ“Œ</div>
              <div class="flex-1">
                <a class="font-medium text-slate-100 hover:underline" href="/html_tailwind/list?id={{ l.id }}">{{ l.name }}</a>
              </div>
              {% if l.priority or l.override_priority %}
              {% set eff = l.override_priority if (l.override_priority is not none and (l.priority is none or l.override_priority > l.priority)) else l.priority %}
              {% if eff %}<div class="text-xs text-slate-400">{{ eff }}</div>{% endif %}
              {% endif %}
            </li>
            {% endfor %}
          </ul>
        </section>
        {% endif %}

        {% if calendar_occurrences and calendar_occurrences|length > 0 %}
        <section class="calendar-summary mb-1">
          <h3 class="text-sm font-semibold mb-1">Calendar</h3>
          <ul class="space-y-1">
            {% for ev in calendar_occurrences %}
            <li class="bg-black-800 rounded p-1">
              <div class="text-slate-100">
                <span class="text-slate-300 font-medium mr-2">{{ ev.occurrence_date or ev.occurrence_dt[:10] }}</span>
                <a class="hover:underline" href="{% if ev.item_type == 'todo' %}/html_no_js/todos/{{ ev.id }}{% else %}/html_tailwind/list?id={{ ev.id }}{% endif %}">{{ ev.title or (ev.rrule or '')[:80] }}</a>
                {% if ev.is_recurring %}<span class="text-xs text-slate-400 ml-2">(recurring)</span>{% endif %}
              </div>
            </li>
            {% endfor %}
          </ul>
        </section>
        {% endif %}

        {# pagination controls (cursor-based) #}
        {% if cursors %}
        <nav class="mb-1 flex gap-1" aria-label="Pages">
          {% if cursors.has_prev %}
          <a href="?dir=prev&cursor_created_at={{ cursors.prev_cursor_created_at|urlencode }}&cursor_id={{ cursors.prev_cursor_id }}" class="px-1 py-1 bg-slate-800 text-slate-100 rounded">Â« Newer</a>
          {% endif %}
          {% if cursors.has_next %}
          <a href="?dir=next&cursor_created_at={{ cursors.next_cursor_created_at|urlencode }}&cursor_id={{ cursors.next_cursor_id }}" class="px-1 py-1 bg-slate-800 text-slate-100 rounded">Older Â»</a>
          {% endif %}
        </nav>
        {% endif %}

        {# Lists grouped by category; uncategorized first #}
        <section class="lists-by-category space-y-1">
          {% set uncats = lists_by_category.get(0, []) %}
          {% if uncats and uncats|length > 0 %}
          <div class="category-section" data-category-id="uncategorized">
            <details class="group bg-black border border-slate-700 rounded-lg" open>
                <summary class="flex items-center justify-between px-1 py-1 cursor-pointer text-lg font-semibold text-slate-100">
                  <span>Uncategorized <span class="text-sm text-slate-400">(<span class="cat-count">{{ uncats|length }}</span>)</span></span>
                <svg class="w-4 h-4 text-slate-300 transform transition-transform duration-150" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path d="M5.23 7.21a.75.75 0 011.06-.02L10 10.67l3.71-3.48a.75.75 0 111.02 1.1l-4.2 3.94a.75.75 0 01-1.04 0L5.25 8.29a.75.75 0 01-.02-1.08z"/></svg>
              </summary>
              <div class="px-1 pb-1 pt-1">
                <div>
                  <ul class="space-y-0 mt-0">
                    {% for lst in uncats %}
                    {% set eff = lst.override_priority if (lst.override_priority is not none and (lst.priority is none or lst.override_priority > lst.priority)) else lst.priority %}
                      <li class="bg-black px-0 py-0" data-list-id="{{ lst.id }}"{% if lst.created_at %} data-created-at="{{ lst.created_at|in_tz(client_tz, '%Y-%m-%dT%H:%M:%S') }}" data-created-hum="{{ lst.created_at|in_tz(client_tz, '%d/%m %-I:%M%p') }}"{% endif %}{% if lst.modified_at %} data-modified-at="{{ lst.modified_at|in_tz(client_tz, '%Y-%m-%dT%H:%M:%S') }}" data-modified-hum="{{ lst.modified_at|in_tz(client_tz, '%d/%m %-I:%M%p') }}"{% endif %} data-priority="{{ eff if eff is not none else '' }}">
                        {% set un = (lst.uncompleted_count if (lst.uncompleted_count is defined) else (lst.uncompleted if (lst.uncompleted is defined) else None)) %}
                        <a class="list-title font-medium {% if lst.completed %}text-slate-400{% else %}text-blue-600{% endif %} hover:underline{% if lst.completed %} line-through done{% endif %}" href="/html_tailwind/list?id={{ lst.id }}">{{ lst.name }}</a>{% if un is not none and not (lst.hide_icons|default(false)) and (un|int) > 0 %}<span class="text-red-400 ml-1">{{ un }}</span>{% endif %}
                        {% set circ = {1:'â‘ ',2:'â‘¡',3:'â‘¢',4:'â‘£',5:'â‘¤',6:'â‘¥',7:'â‘¦',8:'â‘§',9:'â‘¨',10:'â‘©'} %}
                        {% if lst.priority is not none %}
                          <span class="muted priority-inline"><span class="priority-circle text-slate-300">{{ circ.get(lst.priority, lst.priority) }}</span></span>
                        {% endif %}
                        {% if lst.override_priority and (lst.priority is none or lst.override_priority > lst.priority) %}
                          <span class="muted priority-inline priority-override"><span class="priority-circle text-amber-300">{{ circ.get(lst.override_priority, lst.override_priority) }}</span></span>
                        {% endif %}
                        <span class="text-xs text-slate-400 list-date ml-1">{% if lst.modified_at %}mod. {{ lst.modified_at|in_tz(client_tz, '%d/%m %-I:%M%p') }}{% elif lst.created_at %}cr. {{ lst.created_at|in_tz(client_tz, '%d/%m %-I:%M%p') }}{% endif %}</span>
                        {% if lst.hashtags and lst.hashtags|length > 0 %}
                          <div class="inline-block ml-1">
                            {% for tag in (lst.hashtags | sort) %}
                              <a href="/html_no_js/search?q={{ tag|urlencode }}" class="tag-chip">{{ tag }}</a>
                            {% endfor %}
                          </div>
                        {% endif %}
                        <div class="combined-tags mt-0 inline-block ml-1" data-list-id="{{ lst.id }}" aria-live="polite"></div>
                      </li>
                    {% endfor %}
                  </ul>
                </div>
              </div>
            </details>
          </div>
          {% endif %}

          {% for cat in categories %}
          {% set cat_lists = lists_by_category.get(cat.id, []) %}
            {% if cat_lists and cat_lists|length > 0 %}
            <div class="category-section" data-category-id="{{ cat.id }}">
              <details class="group bg-black border border-slate-700 rounded-lg">
                <summary class="flex items-center justify-between px-1 py-1 cursor-pointer text-lg font-semibold text-slate-100">
                  <span>{{ cat.name }} <span class="text-sm text-slate-400">(<span class="cat-count">{{ cat_lists|length }}</span>)</span></span>
                  <svg class="w-4 h-4 text-slate-300 transform transition-transform duration-150" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path d="M5.23 7.21a.75.75 0 011.06-.02L10 10.67l3.71-3.48a.75.75 0 111.02 1.1l-4.2 3.94a.75.75 0 01-1.04 0L5.25 8.29a.75.75 0 01-.02-1.08z"/></svg>
                </summary>
                <div class="px-1 pb-1 pt-1">
                  <div>
                    <ul class="space-y-1 mt-1">
                      {% for lst in cat_lists %}
                      {% set eff = lst.override_priority if (lst.override_priority is not none and (lst.priority is none or lst.override_priority > lst.priority)) else lst.priority %}
                        <li class="bg-black px-0 py-0" data-list-id="{{ lst.id }}"{% if lst.created_at %} data-created-at="{{ lst.created_at|in_tz(client_tz, '%Y-%m-%dT%H:%M:%S') }}" data-created-hum="{{ lst.created_at|in_tz(client_tz, '%d/%m %-I:%M%p') }}"{% endif %}{% if lst.modified_at %} data-modified-at="{{ lst.modified_at|in_tz(client_tz, '%Y-%m-%dT%H:%M:%S') }}" data-modified-hum="{{ lst.modified_at|in_tz(client_tz, '%d/%m %-I:%M%p') }}"{% endif %} data-priority="{{ eff if eff is not none else '' }}">
                          {% set un = (lst.uncompleted_count if (lst.uncompleted_count is defined) else (lst.uncompleted if (lst.uncompleted is defined) else None)) %}
                          <a class="list-title font-medium {% if lst.completed %}text-slate-400{% else %}text-blue-600{% endif %} hover:underline{% if lst.completed %} line-through done{% endif %}" href="/html_tailwind/list?id={{ lst.id }}">{{ lst.name }}</a>{% if un is not none and not (lst.hide_icons|default(false)) and (un|int) > 0 %}<span class="text-red-400 ml-1">{{ un }}</span>{% endif %}
                          {% set circ = {1:'â‘ ',2:'â‘¡',3:'â‘¢',4:'â‘£',5:'â‘¤',6:'â‘¥',7:'â‘¦',8:'â‘§',9:'â‘¨',10:'â‘©'} %}
                          {% if lst.priority is not none %}
                            <span class="muted priority-inline"><span class="priority-circle text-slate-300">{{ circ.get(lst.priority, lst.priority) }}</span></span>
                          {% endif %}
                            {% if lst.override_priority and (lst.priority is none or lst.override_priority > lst.priority) %}
                              <span class="muted priority-inline priority-override"><span class="priority-circle text-amber-300">{{ circ.get(lst.override_priority, lst.override_priority) }}</span></span>
                            {% endif %}
                          <span class="text-xs text-slate-400 list-date ml-1">{% if lst.modified_at %}mod. {{ lst.modified_at|in_tz(client_tz, '%d/%m %-I:%M%p') }}{% elif lst.created_at %}cr. {{ lst.created_at|in_tz(client_tz, '%d/%m %-I:%M%p') }}{% endif %}</span>
                          {% if lst.hashtags and lst.hashtags|length > 0 %}
                            <div class="inline-block ml-1">
                              {% for tag in (lst.hashtags | sort) %}
                                <a href="/html_no_js/search?q={{ tag|urlencode }}" class="tag-chip">{{ tag }}</a>
                              {% endfor %}
                            </div>
                          {% endif %}
                          <div class="combined-tags mt-0 inline-block ml-1" data-list-id="{{ lst.id }}" aria-live="polite"></div>
                        </li>
                      {% endfor %}
                    </ul>
                  </div>
                </div>
              </details>
            </div>
            {% endif %}
          {% endfor %}
        </section>

        <!-- embed server-provided categories as JSON for client-side enhancements -->
        <script type="application/json" id="server-categories">{{ categories | default([]) | tojson | safe }}</script>
        <script>
          (function(){
            try{ var el = document.getElementById('server-categories'); var txt = el ? (el.textContent || el.innerText || '').trim() : '[]'; window.categories = txt ? JSON.parse(txt) : []; } catch(e) { window.categories = []; }
            // Set user's default category ID for optimistic UI placement
            window.userDefaultCategoryId = {{ user_default_category_id | default('null') | tojson | safe }};
          })();
        </script>

        <!-- controls: pill-group compact styling -->
        <!-- Desktop / tablet: show inline -->
        <div class="mt-1 hidden sm:block">
          <div class="flex items-center gap-2">
            <label class="inline-flex items-center gap-2 px-2 py-1 bg-black-800 border border-slate-700 rounded-md text-sm">
              <input type="checkbox" id="hide-completed-checkbox" class="mr-1"> Hide Completed
            </label>
            <div class="inline-flex items-center gap-2 px-2 py-1 bg-black-800 border border-slate-700 rounded-md text-sm">
              <span class="text-sm">Sort lists:</span>
              <select id="list-sort-order" class="ml-1 bg-transparent text-sm text-slate-100 border-none focus:outline-none">
                <option value="created">by creation date</option>
                <option value="modified">by modification date</option>
              </select>
            </div>
            <div class="ml-2">
              <label class="inline-flex items-center gap-2 px-2 py-1 bg-black-800 border border-slate-700 rounded-md text-sm">
                <input type="checkbox" id="show-all-tags-checkbox" class="mr-1"> Show all tags
              </label>
            </div>
          </div>
        </div>

        <!-- Mobile: pill stack (flows with content) -->
        <div class="sm:hidden mt-4">
          <div class="flex flex-col items-center gap-2 max-w-lg mx-auto px-3">
            <label class="w-full inline-flex items-center justify-center gap-2 px-3 py-2 bg-black-800 border border-slate-700 rounded-md text-sm">
              <input type="checkbox" id="hide-completed-checkbox-mobile" class="mr-1" onclick="document.getElementById('hide-completed-checkbox').click()"> Hide Completed
            </label>
            <div class="w-full inline-flex items-center justify-center gap-2 px-3 py-2 bg-black-800 border border-slate-700 rounded-md text-sm">
              <select id="list-sort-order-mobile" class="bg-transparent text-sm text-slate-100 border-none focus:outline-none" onchange="document.getElementById('list-sort-order').value=this.value; document.getElementById('list-sort-order').dispatchEvent(new Event('change'));">
                <option value="created">by created</option>
                <option value="modified">by modified</option>
              </select>
            </div>
            <label class="w-full inline-flex items-center justify-center gap-2 px-3 py-2 bg-black-800 border border-slate-700 rounded-md text-sm">
              <input type="checkbox" id="show-all-tags-checkbox-mobile" class="mr-1" onclick="document.getElementById('show-all-tags-checkbox').click()"> Show all tags
            </label>
          </div>
        </div>

      </main>


      </div>

      </div>


    </div>
    <script src="/static/html_tailwind/tailwind_moved_old_script_blocks.js"></script>
<script>
// Quick-add handler for tailwind index
(function(){
  try{
    var input = document.getElementById('tw-quick-add-text');
    var btn = document.getElementById('tw-quick-add-btn');
    if (!input || !btn) return;
    async function findQuick(){
      var anchors = Array.from(document.querySelectorAll('a[href*="/html_no_js/lists/"]'));
      for (var i=0;i<anchors.length;i++){ if ((anchors[i].textContent||'').trim()==='Quick'){ var m = (anchors[i].href||'').match(/lists\/(\d+)/); if (m) return Number(m[1]); } }
      return null;
    }
    btn.addEventListener('click', async function(){
      var text = (input.value||'').trim(); if (!text) return;
      btn.disabled = true;
      try{
        var listId = await findQuick();
        if (!listId){ var r = await fetch('/lists', { method:'POST', credentials:'same-origin', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ name: 'Quick' }) }); if (!r.ok) throw new Error('create list failed'); var j = await r.json(); listId = j.id; }
        var t = await fetch('/todos', { method:'POST', credentials:'same-origin', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ text: text, list_id: listId, priority: 7 }) });
        if (!t.ok) throw new Error('create todo failed');
  input.value='';
  try { window.location.reload(); } catch(e) { window.location.href = '/html_no_js/'; }
      }catch(e){ console && console.error && console.error(e); alert('Add failed'); }
      finally{ btn.disabled = false; }
    }, false);
  }catch(e){}
})();
</script>
  </body>
</html>

