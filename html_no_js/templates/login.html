{% extends 'base.html' %}
{% block title %}Login â€” Fast Todo (no-js){% endblock %}
{% block content %}
  <h2>Login</h2>
  {% if error %}
    <div class="error" role="alert" style="color:#b91c1c; margin-bottom:0.5rem;">{{ error }}</div>
  {% endif %}
  <form method="post" action="/html_no_js/login">
  {{ csrf_field() }}
    <label>Username <input name="username" required></label>
    <br>
    <label>Password <input name="password" type="password" required></label>
    <br>
    <button type="submit">Log in</button>
  </form>
  <script>
    // Set a tz cookie with the browser timezone before submitting the login form
    (function(){
      try{
        var form = document.querySelector('form[action="/html_no_js/login"]');
        if (!form) return;
        form.addEventListener('submit', function(){
          try{
            var tz = Intl.DateTimeFormat().resolvedOptions().timeZone || '';
            if (tz){
              // set cookie for path / so server sees it on login POST
              document.cookie = 'tz=' + encodeURIComponent(tz) + '; path=/';
            }
          }catch(e){}
        });
      }catch(e){}
    })();
  </script>
{% endblock %}
