{% extends 'base.html' %}
{% block title %}Lists ‚Äî Fast Todo (no-js){% endblock %}
{% block content %}
  <style>
    /* index-only: remove top page margin so the site title sits flush to the top */
    body { margin-top: 0 !important; }
    header { margin-top: 0 !important; }
  /* show completed lists as struck-through on the index */
  .lists-list .list-title.done { text-decoration: line-through; color: #6b7280; }
  /* pinned list: remove default bullets and left padding */
  .pinned-todos ul { list-style: none; padding-left: 0; margin-left: 0; }
  /* category lists: align flush under headers (no indent/bullets) */
  .category-lists { list-style: none; padding-left: 0; margin-left: 0; }
  /* ensure completed todos in the pinned section appear struck-through */
  .pinned-todos .done { text-decoration: line-through; color: #6b7280; }
    /* mobile tweak: show list meta on its own line under the title for small screens */
    @media (max-width: 480px) {
  .list-item { position: relative; padding-right: 0.5rem; }
      /* make the title, edit button and meta flow inline and wrap naturally
        Reserve right padding so content doesn't flow under the absolutely
        positioned delete control; use border-box so padding reduces content
        width rather than increasing overall element size. */
      .list-main { display: block; padding-right: calc(var(--page-side-margin) + 1rem); box-sizing: border-box; }
  .list-title { display: inline; vertical-align: middle; }
  .list-main .list-title { white-space: normal; overflow: visible; text-overflow: clip; overflow-wrap: anywhere; word-break: break-word; min-width: 0; }
    /* Mobile override: allow list titles to wrap and shrink. Use higher
       specificity and !important to override desktop ellipsize rules. */
    .lists-list .list-main .list-title {
      white-space: normal !important;
      overflow: visible !important;
      text-overflow: clip !important;
      overflow-wrap: anywhere !important;
      word-break: break-word !important;
      min-width: 0 !important;
    }
  .edit-list-btn { display: inline; margin-left: 0.4rem; vertical-align: middle; }
  /* move the trash/delete control into the line on the right */
  /* push the icon further into the page margin so it sits nearer the physical
    right edge of the viewport. Increase negative offset to move it outward. */
  /* place the left action visually into the page gutter (same as before). If this creates layout overflow
    on some devices we can instead place it with transform, but that previously shifted icons.
    Reverting to the original so icons appear where expected. */
  /* avoid using a negative `right` value which can expand layout width and
    cause horizontal overflow on some mobile browsers (triggering inset
    overlay scrollbars). Use transform to move the control visually into the
    page gutter; transforms don't affect layout width. This is scoped to
    the small-screen mobile override above. */
  .list-action-left { position: absolute; right: 0; top: 0.5rem; width: auto; flex: initial; display: inline-block; transform: translateX(calc(var(--page-side-margin) + 2.5rem)); will-change: transform; }
  .list-main .meta { display: inline; margin-left: 0.45rem; margin-top: 0; vertical-align: middle; overflow-wrap: anywhere; word-break: break-word; }
    }
  </style>
  <!-- Temporarily disable hashtag suggestion box on index page -->
  <style>
    /* makes sure any suggestion UI is hidden on index while we stabilize mobile scrolling */
    .hashtag-suggest { display: none !important; }
  </style>
  <style>
    /* Mobile: ensure `main` does not create an inner scroll container so iOS shows only one overlay scrollbar.
       This is targeted and preserves desktop/Chrome behavior. */
    @media (pointer: coarse) {
  main { overflow: visible !important; -webkit-overflow-scrolling: touch; min-height: 100vh !important; height: auto !important; }
  /* also make sure direct list container doesn't clip: allow it to grow */
  .lists-list { overflow: visible !important; }
    }
  </style>
  <style>
    /* Make html match the app background so Safari doesn't show the theme-color blue in page margins */
    html { background: var(--bg); }
  </style>
  

  <!-- search form: search lists and todos -->
  <form method="get" action="/html_no_js/search" style="margin:0.5rem 0">
    <input name="q" placeholder="Search lists and todos" value="{{ request.query_params.get('q','') }}">
    <button type="submit">Search</button>
  </form>
  {% if pinned_todos and pinned_todos|length > 0 %}
    <section class="pinned-todos">
      <h3>Pinned</h3>
  <ul>
  {# sort pinned_todos by modified_at (newest first). If modified_at is missing, fall back to original order #}
  {% for t in (pinned_todos | sort(attribute='modified_at') | reverse) %}
        <li>
          <span class="pin-icon {% if t.pinned|default(false) %}pinned{% endif %}">{{ 'üìå' if t.pinned|default(false) else 'üìç' }}</span>
          <a class="{% if t.completed %}done{% endif %}" href="/html_no_js/todos/{{ t.id }}">{{ t.text }}</a>
           <span class="meta">in <a href="/html_no_js/lists/{{ t.list_id }}">{{ t.list_name or t.list_id }}</a></span>
       {% if t.tags and t.tags|length > 0 %}
             <div class="tags-inline">
         {% for tag in (t.tags | sort) %}
                 <a class="tag-chip" href="/html_no_js/search?q={{ tag|urlencode }}">{{ tag }}</a>
               {% endfor %}
             </div>
           {% endif %}
        </li>
      {% endfor %}
      </ul>
    </section>
  {% endif %}
  <form method="post" action="/html_no_js/lists/create">
  {{ csrf_field() }}
  <input name="name" placeholder="List name" required>
    <button type="submit">Create</button>
  </form>
  {# Move calendar summary directly under pinned todos #}
  {% if calendar_occurrences and calendar_occurrences|length > 0 %}
    <section class="calendar-summary">
      <h3>Calendar</h3>
      <ul style="list-style:none;padding-left:0;margin:0 0 1rem 0;">
        {% for ev in calendar_occurrences %}
          <li>
            <strong>{{ ev.occurrence_date or ev.occurrence_dt[:10] }}</strong>
            &nbsp; <a href="{% if ev.item_type == 'todo' %}/html_no_js/todos/{{ ev.id }}{% else %}/html_no_js/lists/{{ ev.id }}{% endif %}">{{ ev.title or (ev.rrule or '')[:60] }}</a>
            {% if ev.is_recurring %}<span class="muted"> (recurring)</span>{% endif %}
          </li>
        {% endfor %}
      </ul>
    </section>
  {% endif %}
  
  {% if cursors %}
    <nav class="pagination" aria-label="Pages">
      {% if cursors.has_prev %}
        <a href="?dir=prev&cursor_created_at={{ cursors.prev_cursor_created_at|urlencode }}&cursor_id={{ cursors.prev_cursor_id }}">&laquo; Newer</a>
      {% endif %}
      {% if cursors.has_next %}
        <a href="?dir=next&cursor_created_at={{ cursors.next_cursor_created_at|urlencode }}&cursor_id={{ cursors.next_cursor_id }}">Older &raquo;</a>
      {% endif %}
    </nav>
  {% endif %}
  <ul class="lists-list">
  {# Uncategorized (no category) - render first so it appears at the top #}
  {% set uncats = lists_by_category.get(0, []) %}
  {% if uncats and uncats|length > 0 %}
    <li class="category-section" data-category-id="uncategorized">
      <h3 class="category-header" data-target="cat-uncat" style="cursor:pointer; user-select:none;">
        <span class="twisty" aria-hidden="true">‚ñæ</span>
        <span class="category-name">Uncategorized</span>
        <span class="count muted"> ({{ uncats|length }})</span>
      </h3>
      <ul id="cat-uncat" class="category-lists">
        {% for lst in uncats %}
          {% set created_iso = lst.created_at|in_tz(client_tz, '%Y-%m-%dT%H:%M:%S') %}
          {% set modified_iso = lst.modified_at|in_tz(client_tz, '%Y-%m-%dT%H:%M:%S') if lst.modified_at else None %}
          <li class="list-item"{% if created_iso %} data-created-at="{{ created_iso }}"{% endif %}{% if modified_iso %} data-modified-at="{{ modified_iso }}"{% endif %} data-priority="{{ lst.priority if lst.priority is not none else '' }}">
            <div class="list-main">
              <a class="list-title {% if lst.completed %}done{% endif %}" href="/html_no_js/lists/{{ lst.id }}">{{ lst.name }}</a>
              <button type="button" class="list-action-btn edit-list-btn" data-list-id="{{ lst.id }}" data-list-name="{{ lst.name|e }}" title="Edit list name">‚úèÔ∏è</button>
                {% if lst.priority %}
                {% set circ = {1:'‚ë†',2:'‚ë°',3:'‚ë¢',4:'‚ë£',5:'‚ë§',6:'‚ë•',7:'‚ë¶',8:'‚ëß',9:'‚ë®',10:'‚ë©'} %}
                <span class="meta priority-inline"><span class="priority-circle">{{ circ.get(lst.priority, lst.priority) }}</span></span>
              {% endif %}
              {% if lst.created_at %}
                <div class="meta">cr. {{ lst.created_at|in_tz(client_tz, '%d/%m %-I:%M%p') }}</div>
              {% endif %}
              <div class="all-tags-inline" data-list-id="{{ lst.id }}" data-list-tags='{{ lst.hashtags | tojson }}' aria-hidden="true"></div>
            </div>
          </li>
        {% endfor %}
      </ul>
    </li>
  {% endif %}

  {# Render each category section in category.position order #}
  {% for cat in categories %}
  {% set cat_lists = lists_by_category.get(cat.id, []) %}
    {% if cat_lists and cat_lists|length > 0 %}
      <li class="category-section" data-category-id="{{ cat.id }}">
        <h3 class="category-header" data-target="cat-{{ cat.id }}" style="cursor:pointer; user-select:none;">
          <span class="twisty" aria-hidden="true">‚ñæ</span>
          <span class="category-name">{{ cat.name }}</span>
          <span class="count muted"> ({{ cat_lists|length }})</span>
        </h3>
        <ul id="cat-{{ cat.id }}" class="category-lists">
          {% for lst in cat_lists %}
            {% set created_iso = lst.created_at|in_tz(client_tz, '%Y-%m-%dT%H:%M:%S') %}
            {% set modified_iso = lst.modified_at|in_tz(client_tz, '%Y-%m-%dT%H:%M:%S') if lst.modified_at else None %}
            <li class="list-item"{% if created_iso %} data-created-at="{{ created_iso }}"{% endif %}{% if modified_iso %} data-modified-at="{{ modified_iso }}"{% endif %} data-priority="{{ lst.priority if lst.priority is not none else '' }}">
              <div class="list-main">
                <a class="list-title {% if lst.completed %}done{% endif %}" href="/html_no_js/lists/{{ lst.id }}">{{ lst.name }}</a>
                <button type="button" class="list-action-btn edit-list-btn" data-list-id="{{ lst.id }}" data-list-name="{{ lst.name|e }}" title="Edit list name">‚úèÔ∏è</button>
                {% if lst.priority %}
                  {% set circ = {1:'‚ë†',2:'‚ë°',3:'‚ë¢',4:'‚ë£',5:'‚ë§',6:'‚ë•',7:'‚ë¶',8:'‚ëß',9:'‚ë®',10:'‚ë©'} %}
                  <span class="meta priority-inline"><span class="priority-circle">{{ circ.get(lst.priority, lst.priority) }}</span></span>
                {% endif %}
                {% if lst.created_at %}
                  <div class="meta">cr. {{ lst.created_at|in_tz(client_tz, '%d/%m %-I:%M%p') }}</div>
                {% endif %}
                <div class="all-tags-inline" data-list-id="{{ lst.id }}" data-list-tags='{{ lst.hashtags | tojson }}' aria-hidden="true"></div>
              </div>
            </li>
          {% endfor %}
        </ul>
      </li>
    {% endif %}
  {% endfor %}
  </ul>

<!-- Quick link to categories page -->
<div style="margin-bottom:0.75rem;">
  <a href="/html_no_js/categories" class="btn" style="font-weight:bold;">‚Üí Categories</a>
</div>

<script>
  // expose categories metadata from server to client-side scripts
  // categories should serialize to a JSON array; default to [] if missing
  window.categories = {{ categories | default([]) | tojson | safe }};
</script>

{% if calendar_occurrences and calendar_occurrences|length > 0 %}
  <section class="calendar-summary" style="margin-top:1rem;">
    <h3>Calendar</h3>
    <ul style="list-style:none;padding-left:0;margin:0;">
      {% for ev in calendar_occurrences %}
        <li>
          <strong>{{ ev.occurrence_date or ev.occurrence_dt[:10] }}</strong>
          &nbsp; <a href="{% if ev.item_type == 'todo' %}/html_no_js/todos/{{ ev.id }}{% else %}/html_no_js/lists/{{ ev.id }}{% endif %}">{{ ev.title or (ev.rrule or '')[:60] }}</a>
          {% if ev.is_recurring %}<span class="muted"> (recurring)</span>{% endif %}
        </li>
      {% endfor %}
    </ul>
  </section>
{% endif %}

<!-- Hide Completed control (browser-cookie persisted) -->
<div id="hide-completed-control" style="margin:0.5rem 0;">
  <label><input type="checkbox" id="hide-completed-checkbox"> Hide Completed</label>
  <span class="meta" style="margin-left:0.5rem; color: var(--muted, #6b7280);"></span>
  <!-- meta reserved for future counts or hints -->
  
</div>

<!-- Show all tags control (browser-cookie persisted) -->
<div id="sort-and-tags" style="margin-top:1rem; display:flex; gap:1rem; align-items:center; flex-wrap:wrap;">
  <label style="margin-right:0.5rem;"><input type="checkbox" id="show-all-tags-checkbox"> Show all tags</label>
  <span style="flex:1 1 auto"></span>
  <label>Sort lists: 
    <select id="list-sort-order">
      <option value="created">by creation date</option>
      <option value="modified">by modification date</option>
    </select>
  </label>
</div>
{% endblock %}



{% block scripts %}
{{ super() }}
<script>
// Sorting within categories by created_at or modified_at; persisted in a cookie
(function(){
  function setCookie(name, value, days){ var expires=''; if(days){ var d=new Date(); d.setTime(d.getTime() + (days*24*60*60*1000)); expires='; expires='+d.toUTCString(); } document.cookie = name + '=' + encodeURIComponent(value) + expires + '; path=/'; }
  function getCookie(name){ var m = document.cookie.match('(?:^|; )' + name + '=([^;]*)'); return m ? decodeURIComponent(m[1]) : null; }
  var sel = document.getElementById('list-sort-order'); if (!sel) return;
  var cookieName = 'index_list_sort_order';
  var cur = getCookie(cookieName) || 'created';
  sel.value = (cur === 'modified') ? 'modified' : 'created';

  function parseISO(v){ try { return v ? new Date(v).getTime() : 0; } catch(_) { return 0; } }
  function parsePri(el){ var v = el.getAttribute('data-priority'); if (v==null || v==='') return null; var n = parseInt(v,10); return isNaN(n) ? null : n; }
  function sortUl(ul){
    var lis = Array.from(ul.querySelectorAll(':scope > li.list-item'));
    // determine category id for this ul by traversing up to .category-section
    var catSection = ul.closest('.category-section');
    var catId = null;
    try { catId = catSection ? catSection.getAttribute('data-category-id') : null; } catch(e) { catId = null; }
    lis.sort(function(a,b){
      var pa = parsePri(a), pb = parsePri(b);
      var aHas = (pa !== null), bHas = (pb !== null);
      if (aHas && !bHas) return -1; // priority first
      if (!aHas && bHas) return 1;
  if (aHas && bHas && pa !== pb) return pb - pa; // higher number first
      // If this category requests alphanumeric sorting, sort by visible list title
      try {
        if (catId && categorySortMap && categorySortMap[catId]) {
          var an = (a.querySelector && a.querySelector('.list-title')) ? (a.querySelector('.list-title').textContent || '') : (a.textContent || '');
          var bn = (b.querySelector && b.querySelector('.list-title')) ? (b.querySelector('.list-title').textContent || '') : (b.textContent || '');
          // localeCompare for alphanumeric-ish ordering
          return an.localeCompare(bn, undefined, {numeric: true, sensitivity: 'base'});
        }
      } catch(e) {
        // fall back to date-based sorting on error
      }
      // tie-breaker: selected date newest first
      var ad = 0, bd = 0;
      if (sel.value === 'modified') {
        ad = parseISO(a.getAttribute('data-modified-at')) || parseISO(a.getAttribute('data-created-at'));
        bd = parseISO(b.getAttribute('data-modified-at')) || parseISO(b.getAttribute('data-created-at'));
      } else {
        ad = parseISO(a.getAttribute('data-created-at'));
        bd = parseISO(b.getAttribute('data-created-at'));
      }
      return bd - ad; // newest first
    });
    lis.forEach(function(li){ ul.appendChild(li); });
  }
  function applySort(){
  document.querySelectorAll('ul.category-lists').forEach(function(ul){ sortUl(ul); });
  }
  sel.addEventListener('change', function(){ setCookie(cookieName, sel.value, 365); applySort(); });
  // initial
  // Build a map of category id -> sort_alphanumeric from server-rendered `categories` var
  var categorySortMap = {};
  try {
    if (typeof window !== 'undefined' && window.categories && Array.isArray(window.categories)) {
      window.categories.forEach(function(c){ categorySortMap[String(c.id)] = !!c.sort_alphanumeric; });
    } else {
      // try to read categories from a global JSON embedded by server (Jinja will set `categories` var)
      if (typeof categories !== 'undefined' && Array.isArray(categories)) {
        categories.forEach(function(c){ categorySortMap[String(c.id)] = !!c.sort_alphanumeric; });
      }
    }
  } catch(e) { /* ignore */ }
  applySort();
})();
// react to category sort changes coming from other tabs/pages
window.addEventListener && window.addEventListener('storage', function(ev){
  if (!ev || !ev.key) return;
  try {
    if (ev.key === 'category_sort_changed'){
      var obj = JSON.parse(ev.newValue || '{}');
      if (obj && obj.id != null){
        categorySortMap[String(obj.id)] = !!obj.sort;
        // reapply sorting across category lists
        document.querySelectorAll('ul.category-lists').forEach(function(ul){ try{ ul && ul.dispatchEvent(new CustomEvent('reapply-sort')); }catch(e){} });
        // also directly call applySort if available
        try { if (typeof applySort === 'function') applySort(); } catch(e){}
      }
    }
  } catch(e) {}
});
  // Remove any leftover suggestion box elements on the index page to fully disable it here
  try {
    var h1 = document.getElementById('hashtag-suggest'); if (h1) h1.remove();
    var h2 = document.getElementById('todo-hashtag-suggest'); if (h2) h2.remove();
  } catch(e) { /* ignore */ }
</script>
<script>
// Hide Completed lists (persisted via cookie); hides li.list-item whose title has class 'done'
(function(){
  function setCookie(name, value, days){ var expires=''; if(days){ var d=new Date(); d.setTime(d.getTime() + (days*24*60*60*1000)); expires='; expires='+d.toUTCString(); } document.cookie = name + '=' + encodeURIComponent(value) + expires + '; path=/'; }
  function getCookie(name){ var m = document.cookie.match('(?:^|; )' + name + '=([^;]*)'); return m ? decodeURIComponent(m[1]) : null; }
  var cb = document.getElementById('hide-completed-checkbox'); if (!cb) return;
  var cookieName = 'index_hide_completed_lists';
  cb.checked = getCookie(cookieName) === '1';
  function apply(){
    var hide = cb.checked;
    document.querySelectorAll('ul.category-lists > li.list-item').forEach(function(li){
      var isDone = !!li.querySelector('.list-title.done');
      li.style.display = (hide && isDone) ? 'none' : '';
    });
    // update category counts to reflect hidden items
    try{
      document.querySelectorAll('.category-section').forEach(function(section){
        var ul = section.querySelector('ul.category-lists');
        if (!ul) return;
        var total = ul.querySelectorAll(':scope > li.list-item').length;
        var visible = ul.querySelectorAll(':scope > li.list-item:not([style*="display: none"])').length;
        var countSpan = section.querySelector('.count');
        if (countSpan) countSpan.textContent = ' (' + visible + ')';
      });
    }catch(e){}
  }
  cb.addEventListener('change', function(){ setCookie(cookieName, cb.checked ? '1' : '0', 365); apply(); });
  // initial
  apply();
})();
</script>
<!-- overflow-debug script removed -->

<script>
// Minimal rename using prompt(); posts new name to server endpoint
(function(){
  document.querySelectorAll('.edit-list-btn').forEach(function(btn){
    btn.addEventListener('click', function(){
      var id = btn.getAttribute('data-list-id');
      var current = btn.getAttribute('data-list-name') || '';
      var name = window.prompt('New list name', current);
      if (!name || name.trim() === '' ) return;
      // POST as form so CSRF macro and server accept it
      var fd = new FormData();
      fd.append('name', name);
      // include csrf from page if present
      var csrfInput = document.querySelector('input[name="_csrf"]');
      if (csrfInput && csrfInput.value) fd.append('_csrf', csrfInput.value);
      fetch('/html_no_js/lists/' + encodeURIComponent(id) + '/edit', { method: 'POST', body: fd, credentials: 'same-origin' })
        .then(function(res){ if (res.ok) location.reload(); else alert('Rename failed'); })
        .catch(function(){ alert('Rename failed'); });
    });
  });
})();
</script>

<script>
// Collapsible category sections with localStorage persistence
(function(){
  function storageKey(id){ return 'cat-collapsed-' + id; }
  function isCollapsed(id){ try { return localStorage.getItem(storageKey(id)) === '1'; } catch(e){ return false; } }
  function setCollapsed(id, v){ try { localStorage.setItem(storageKey(id), v ? '1' : '0'); } catch(e){} }
  function applyState(header){
    var targetId = header.getAttribute('data-target');
    var ul = document.getElementById(targetId);
    if (!ul) return;
    var id = header.parentElement && header.parentElement.getAttribute('data-category-id') || targetId;
    var collapsed = isCollapsed(id);
    ul.style.display = collapsed ? 'none' : '';
    var twisty = header.querySelector('.twisty');
    if (twisty) twisty.textContent = collapsed ? '‚ñ∏' : '‚ñæ';
  }
  document.querySelectorAll('.category-header').forEach(function(h){
    applyState(h);
    h.addEventListener('click', function(){
      var id = h.parentElement && h.parentElement.getAttribute('data-category-id') || h.getAttribute('data-target');
      var now = !isCollapsed(id);
      setCollapsed(id, now);
      applyState(h);
    });
  });
})();
</script>

<script>
// Show All Tags control: store state in a cookie and fetch combined tags per list
(function(){
  function setCookie(name, value, days){
    var expires = '';
    if (days){
      var d = new Date(); d.setTime(d.getTime() + (days*24*60*60*1000));
      expires = '; expires=' + d.toUTCString();
    }
    document.cookie = name + '=' + encodeURIComponent(value) + expires + '; path=/';
  }
  function getCookie(name){
    var v = document.cookie.match('(?:^|; )' + name + '=([^;]*)');
    return v ? decodeURIComponent(v[1]) : null;
  }

  var checkbox = document.getElementById('show-all-tags-checkbox');
  if (!checkbox) return;
  // initialize state
  var state = getCookie('show_all_tags') === '1';
  checkbox.checked = state;

  function clearAllTagPlaceholders(){
    document.querySelectorAll('.all-tags-inline').forEach(function(c){ c.innerHTML = ''; c.setAttribute('aria-hidden','true'); });
  }

  function renderTagsInto(container, tags){
    container.innerHTML = '';
    tags.forEach(function(tag){
      var a = document.createElement('a');
      a.className = 'tag-chip';
      a.href = '/html_no_js/search?q=' + encodeURIComponent(tag);
      a.textContent = tag;
      container.appendChild(a);
      container.appendChild(document.createTextNode(' '));
    });
    container.setAttribute('aria-hidden','false');
  }

  async function fetchCombinedTags(listId){
    try{
      var resp = await fetch('/lists/' + encodeURIComponent(listId) + '/hashtags?include_todo_tags=1&combine=1', { credentials: 'same-origin' });
      if (!resp.ok) return [];
      var data = await resp.json();
      return data.hashtags || [];
    }catch(e){ return []; }
  }

  async function refreshAllTags(){
    var containers = document.querySelectorAll('.all-tags-inline');
    containers.forEach(async function(c){
      var lid = c.getAttribute('data-list-id');
      var listTagsJson = c.getAttribute('data-list-tags');
      var listTags = [];
      try{ listTags = listTagsJson ? JSON.parse(listTagsJson) : []; }catch(e){ listTags = []; }
      if (!checkbox.checked){
        // render only the server-provided list tags
        if (listTags && listTags.length) renderTagsInto(c, listTags);
        else { c.innerHTML = ''; c.setAttribute('aria-hidden','true'); }
        return;
      }
      // checkbox checked: fetch combined tags and render
      var combined = await fetchCombinedTags(lid);
      if (combined && combined.length) renderTagsInto(c, combined);
      else { c.innerHTML = ''; c.setAttribute('aria-hidden','true'); }
    });
  }

  checkbox.addEventListener('change', function(){
    setCookie('show_all_tags', checkbox.checked ? '1' : '0', 365);
    refreshAllTags();
  });

  // initialize rendering on load (renders server-provided list tags when unchecked)
  refreshAllTags();
})();
</script>

{% endblock %}

