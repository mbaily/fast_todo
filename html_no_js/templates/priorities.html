{% extends 'base.html' %}
{% block title %}Priorities — Fast Todo (no-js){% endblock %}
{% block content %}
  {% block page_style %}
    <style>
      :root { --page-top-gap: 0; --page-top-margin: 0; }
      /* also collapse any extra margin on the main content for strict flush */
      main { margin-top: 0; }
    </style>
  {% endblock %}
  <h2>Priority summary</h2>
  {% set circled = {1:'①',2:'②',3:'③',4:'④',5:'⑤',6:'⑥',7:'⑦',8:'⑧',9:'⑨',10:'⑩'} %}
  <div id="hide-completed-control" style="margin-bottom:0.5rem;">
    <label><input type="checkbox" id="hide-completed-checkbox"> Hide completed</label>
    <span class="meta" style="margin-left:0.5rem; color: var(--muted, #6b7280);">(default: on)</span>
  </div>
  <p class="meta">Lists (highest priority first)</p>
  <ul class="lists-list">
    {% for l in lists if l.priority is not none %}
      <li class="list-item"><a class="list-title" href="/html_no_js/lists/{{ l.id }}">{{ l.name }}</a>
        <span class="meta priority-inline" style="margin-left:0.5rem"><span class="priority-circle">{{ circled.get(l.priority, l.priority) }}</span></span>
      </li>
    {% endfor %}
  </ul>
  <h3 style="margin-top:1rem">Todos (highest priority first)</h3>
  <ul class="todos-list">
    {% for t, l in todos if t.priority is not none %}
    <li class="todo"><div class="todo-content"><div class="todo-main"><div class="todo-title-inline"><a class="wrap-text" href="/html_no_js/todos/{{ t.id }}">{{ t.text }}</a>
    <span class="meta priority-inline" style="margin-left:0.35rem"><span class="priority-circle">{{ circled.get(t.priority, t.priority) }}</span></span></div><div class="meta">in <a href="/html_no_js/lists/{{ l.id }}">{{ l.name }}</a></div></div></div></li>
    {% endfor %}
  </ul>
{% endblock %}
{% block scripts %}
{{ super() }}
<script>
// Hide Completed control for priorities page (persist via cookie)
(function(){
  function setCookie(name, value, days){ var expires=''; if(days){ var d=new Date(); d.setTime(d.getTime() + (days*24*60*60*1000)); expires='; expires='+d.toUTCString(); } document.cookie = name + '=' + encodeURIComponent(value) + expires + '; path=/'; }
  function getCookie(name){ var m = document.cookie.match('(?:^|; )' + name + '=([^;]*)'); return m ? decodeURIComponent(m[1]) : null; }
  var cb = document.getElementById('hide-completed-checkbox'); if (!cb) return;
  var cookieName = 'priorities_hide_completed';
  // default on
  var cur = getCookie(cookieName);
  cb.checked = (cur === null) ? true : (cur === '1');
  cb.addEventListener('change', function(){ setCookie(cookieName, cb.checked ? '1' : '0', 365); location.reload(); });
})();
</script>
{% endblock %}
